DROP SCHEMA IF EXISTS postgres CASCADE;
CREATE SCHEMA postgres;
CREATE SEQUENCE hibernate_sequence START WITH 100 INCREMENT BY 1;

-- Table: treatment
CREATE TABLE treatment
(
    id         INT         NOT NULL PRIMARY KEY,
    name       VARCHAR(50) NOT NULL,
    type       VARCHAR(20) CHECK ( type IN ('MEDICAL_PROCEDURE', 'MEDICINE')),
    dosageForm VARCHAR(30) CHECK ( dosageForm IN ('TAB', 'ML'))
);

-- Table: users
CREATE TABLE users
(
    id        INT                                                                      NOT NULL PRIMARY KEY,
    firstName VARCHAR(50)                                                              NOT NULL,
    lastName  VARCHAR(50)                                                              NOT NULL,
    role      VARCHAR(30) CHECK ( role IN ('ROLE_ADMIN', 'ROLE_DOCTOR', 'ROLE_NURSE')) NOT NULL,
    email     VARCHAR(50)                                                              NOT NULL,
    password  VARCHAR(255)                                                             NOT NULL
);

-- Table: patients
CREATE TABLE patients
(
    id              INT                                                      NOT NULL PRIMARY KEY,
    firstName       VARCHAR(30)                                              NOT NULL,
    lastName        VARCHAR(30)                                              NOT NULL,
    healthInsurance BIGINT                                                   NOT NULL,
    startDate       TIMESTAMP                                                NOT NULL,
    status          VARCHAR(30) CHECK ( status IN ('TREATED', 'DISCHARGED')) NOT NULL,
    diagnosis       VARCHAR(255),
    doctor_id       INT,
    FOREIGN KEY (doctor_id) REFERENCES users (id)
);

-- Table: appointments
CREATE TABLE appointments
(
    id           INT       NOT NULL PRIMARY KEY,
    startdate    TIMESTAMP NOT NULL,
    enddate      TIMESTAMP NOT NULL,
    dosage       INT     ,
    patient_id   INT,
    FOREIGN KEY (patient_id) REFERENCES patients (id),
    treatment_id INT,
    FOREIGN KEY (treatment_id) REFERENCES treatment (id)
);

-- Table for mapping appointments and daysOfWeek: appointments_daysofweek
CREATE TABLE appointments_daysofweek
(
    appointment_id INT     NOT NULL,
    dayofweek      VARCHAR NOT NULL,

    FOREIGN KEY (appointment_id) REFERENCES appointments (id)
);

CREATE TABLE appointments_timeoftheday
(
    appointment_id INT     NOT NULL,
    time           VARCHAR NOT NULL,

    FOREIGN KEY (appointment_id) REFERENCES appointments (id)
);

-- Table: events
CREATE TABLE events
(
    id             INT                                                            NOT NULL,
    date           TIMESTAMP                                                      NOT NULL,
    status         VARCHAR(30) CHECK (status IN ('PLANNED', 'DONE', 'CANCELLED')) NOT NULL,
    comment        VARCHAR(255),
    appointment_id INT,
    FOREIGN KEY (appointment_id) REFERENCES appointments (id)
);




INSERT INTO users
VALUES (1, 'Stepan', 'Stepanov', 'ROLE_DOCTOR', 'stepanov@mail.ru',
        '$2a$11$awcx8Xi/jmgOhQy5G3By7uBh.s/ai5GmWIYFV/fyqwerI4cAWBAE6');
INSERT INTO users
VALUES (2, 'Vasya', 'Brown', 'ROLE_DOCTOR', 'brown@com.com', '12323434241234');
INSERT INTO treatment
VALUES (1, 'happiness', 'MEDICAL_PROCEDURE', NULL);
INSERT INTO treatment
VALUES (2, 'love', 'MEDICINE', 'TAB');
INSERT INTO patients
VALUES (1, 'Ivan', 'Ivanov', 1234567890123456, '2020-03-23', 'TREATED', 'flu', 2);
INSERT INTO patients
VALUES (2, 'Petr', 'Petrov', 1122334455667788, '2020-03-24', 'TREATED', 'virus', 2);
INSERT INTO appointments
VALUES (1, '2020-03-23', '2010-03-25', null, 1, 1);
INSERT INTO appointments
VALUES (2, '2020-03-23', '2020-03-26', 8, 2, 2);
INSERT INTO appointments
VALUES (3, '2020-03-25', '2010-03-25', 10, 1, 2);


INSERT INTO events
VALUES (1, '2020-03-23T10:30', 'PLANNED', null, 1);
INSERT INTO events
VALUES (2, '2020-03-23T13:30', 'PLANNED', null, 2);
INSERT INTO events
VALUES (3, '2020-03-25T10:30', 'PLANNED', null, 2);
INSERT INTO events
VALUES (4, '2020-03-23T16:30', 'PLANNED', null, 3);

INSERT INTO appointments_daysofweek
VALUES (1, 'MON');
INSERT INTO appointments_daysofweek
VALUES (1, 'WED');
INSERT INTO appointments_daysofweek
VALUES (2, 'FRI');
INSERT INTO appointments_daysofweek
VALUES (3, 'SAT');

INSERT INTO appointments_timeoftheday
VALUES (1, 'AM_11');
INSERT INTO appointments_timeoftheday
VALUES (1, 'PM_3');
INSERT INTO appointments_timeoftheday
VALUES (2, 'AM_4');
INSERT INTO appointments_timeoftheday
VALUES (3, 'AM_10');







